<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>czSignature.js - Advanced Demo</title>
    <style>
        :root {
            --primary-color: #007bff; --secondary-color: #6c757d; --info-color: #17a2b8; --background-color: #f8f9fa;
            --panel-background: #ffffff; --text-color: #343a40; --border-color: #dee2e6;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0; background-color: var(--background-color); color: var(--text-color);
            display: flex; flex-direction: column; min-height: 100vh;
        }
        header {
            background-color: var(--panel-background); padding: 1rem 2rem;
            border-bottom: 1px solid var(--border-color); box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            text-align: center; position: relative;
        }
        header h1 { margin: 0; color: var(--primary-color); font-size: 1.75rem; }
        header p { margin: 0.25rem 0 0; color: var(--secondary-color); }
        .github-link {
            position: absolute; top: 1rem; right: 1rem;
            display: inline-block;
            transition: transform 0.2s ease-out, fill 0.2s ease-out;
            line-height: 0;
        }
        .github-link:hover {
            transform: scale(1.1);
            animation: bounceGitHub 0.6s ease-in-out infinite alternate;
        }
        .github-link svg {
            width: 36px;
            height: 36px;
            fill: var(--text-color);
            transition: fill 0.2s ease-in-out;
        }
        .github-link:hover svg {
            fill: var(--primary-color);
        }
        @keyframes bounceGitHub {
            0% { transform: translateY(0) scale(1.1); }
            50% { transform: translateY(-8px) scale(1.1); }
            100% { transform: translateY(0) scale(1.1); }
        }
        .demo-container { display: flex; flex: 1; padding: 1.5rem; gap: 1.5rem; }
        .controls-panel {
            width: 320px; flex-shrink: 0; background-color: var(--panel-background);
            border-radius: 12px; padding: 1.5rem; box-shadow: var(--shadow);
            overflow-y: auto; height: fit-content;
        }
        .control-group { margin-bottom: 1.5rem; }
        .control-group h3 {
            margin: 0 0 1rem; font-size: 1rem; font-weight: 600;
            border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem;
        }
        .control { margin-bottom: 1rem; }
        .control label, .radio-group-label, .checkbox-group-label {
            display: flex; justify-content: space-between; align-items: center;
            font-size: 0.875rem; margin-bottom: 0.5rem; font-weight: 500;
        }
        .control label .value-display { font-weight: 400; color: var(--secondary-color); }
        .radio-group div, .checkbox-group div { display: flex; gap: 1rem; }
        input[type="range"] { width: 100%; cursor: pointer; }
        input[type="color"] { width: 100%; height: 35px; border: 1px solid var(--border-color); border-radius: 6px; padding: 2px; cursor: pointer; }
        .main-content { flex: 1; min-width: 0; }
        .signature-wrapper { background-color: var(--panel-background); border-radius: 12px; padding: 1.5rem; box-shadow: var(--shadow); }
        h2 { text-align: left; margin: 0 0 1rem; font-size: 1.25rem; }
        .canvas-container {
            width: 100%; aspect-ratio: 2.5; border: 1px solid var(--border-color);
            border-radius: 8px; margin-bottom: 1rem; overflow: hidden;
        }
        .signature-canvas { display: block; width: 100%; height: 100%; cursor: crosshair; touch-action: none; border-radius: 8px; }
        .actions-group { display: flex; gap: 0.75rem; margin-bottom: 1.5rem; flex-wrap: wrap; }
        .actions-group .btn {
            flex-grow: 1; min-width: 80px; padding: 0.75rem 1rem; font-size: 0.875rem;
            border: none; border-radius: 6px; cursor: pointer; font-weight: 500;
            color: white; transition: transform 0.1s, box-shadow 0.2s;
        }
        .actions-group .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .actions-group .btn:active { transform: translateY(0); }
        .btn-clear { background-color: #dc3545; }
        .btn-undo { background-color: #ffc107; color: #343a40 !important; }
        .btn-save { background-color: #28a745; }
        .btn-info { background-color: var(--info-color); }
        .btn-secondary { background-color: var(--secondary-color); }
        .output-format-selector { margin-bottom: 1.5rem; }
        .signature-output { width: 100%; margin-top: 1rem; display: none; }
        .signature-textarea {
            width: 100%; min-height: 150px; font-family: 'Courier New', monospace; font-size: 12px;
            padding: 1rem; border: 1px solid var(--border-color); border-radius: 6px;
            resize: vertical; box-sizing: border-box; background-color: #e9ecef;
        }
        .signature-preview {
            position: relative; width: 100%; border: 1px solid var(--border-color);
            border-radius: 6px; padding: 1rem; background-color: white; display: flex;
            justify-content: center; align-items: center; aspect-ratio: 2.5;
            box-sizing: border-box; overflow: hidden; margin-top: 1rem;
        }
        .signature-preview svg, .signature-preview img { max-width: 100%; max-height: 100%; width: auto; height: auto; }
        .btn-download {
            position: absolute; top: 0.75rem; right: 0.75rem; padding: 0.5rem;
            background-color: var(--primary-color); border: none; border-radius: 6px;
            cursor: pointer; display: none; transition: background-color 0.2s, transform 0.2s;
        }
        .btn-download:hover { background-color: #0056b3; transform: scale(1.05); }
        .btn-download svg { width: 24px; height: 24px; fill: white; display: block; }
        footer { text-align: center; padding: 1.5rem; color: var(--secondary-color); font-size: 0.875rem; }
        footer a { color: var(--primary-color); text-decoration: none; }
        footer a:hover { text-decoration: underline; }
        .signature-notification {
            position: fixed; top: 20px; right: 20px; padding: 15px 20px; border-radius: 6px;
            font-weight: 500; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 10000;
            transform: translateX(120%); transition: transform 0.3s ease-in-out; display: none;
        }
        .signature-notification.show { transform: translateX(0); display: block; }
        .signature-notification-success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .signature-notification-error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        @media (max-width: 992px) {
            .demo-container { flex-direction: column; }
            .controls-panel { width: 100%; box-sizing: border-box; height: auto; }
            .github-link { position: static; transform: none; margin-top: 1rem; display: block; text-align: center;}
            .github-link:hover { animation: none; transform: none; }
        }
    </style>
</head>
<body>

<header>
    <h1>czSignature.js Advanced Demo</h1>
    <p>An interactive demonstration page for czSignature.js with customization options.</p>
    <a href="https://github.com/cyberzilla/czsignature" class="github-link" target="_blank" rel="noopener noreferrer" title="View on GitHub">
        <svg viewBox="0 0 24 24" aria-hidden="true" fill="currentColor">
            <path fill-rule="evenodd" d="M12 0C5.373 0 0 5.373 0 12c0 5.302 3.438 9.879 8.205 11.465.6.111.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61-.546-1.387-1.334-1.758-1.334-1.758-1.09-.743.082-.728.082-.728 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.492.997.108-.775.418-1.305.762-1.605-2.665-.3-5.464-1.332-5.464-5.93 0-1.31.467-2.38 1.236-3.22-.124-.3-.535-1.52.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.399 1.02 0 2.046.133 3.003.399 2.293-1.552 3.301-1.23 3.301-1.23.652 1.656.241 2.876.117 3.176.77.84 1.236 1.91 1.236 3.22 0 4.61-2.803 5.625-5.474 5.922.429.369.816 1.102.816 2.222 0 1.606-.015 2.899-.015 3.284 0 .322.217.697.825.577C20.562 21.879 24 17.302 24 12 24 5.373 18.627 0 12 0z"/>
        </svg>
    </a>
</header>

<main class="demo-container">
    <aside class="controls-panel">
        <div class="control-group">
            <h3>Appearance</h3>
            <div class="control">
                <label for="penColor">Pen Color</label>
                <input type="color" id="penColor" value="#000000">
            </div>
            <div class="control">
                <label for="backgroundColor">Background Color</label>
                <input type="color" id="backgroundColor" value="#ffffff">
            </div>
        </div>
        <div class="control-group">
            <h3>Brush Dynamics</h3>
            <div class="control">
                <label for="minWidth">Min Width <span class="value-display" id="minWidth-val">1.0</span></label>
                <input type="range" id="minWidth" min="0.1" max="5" step="0.1" value="1.0">
            </div>
            <div class="control">
                <label for="maxWidth">Max Width <span class="value-display" id="maxWidth-val">4.0</span></label>
                <input type="range" id="maxWidth" min="0.5" max="15" step="0.1" value="4.0">
            </div>
            <div class="control">
                <label class="checkbox-group-label">Enable Pressure Support <input type="checkbox" id="pressureSupport"></label>
            </div>
        </div>
        <div class="control-group">
            <h3>Smoothing & Simplification</h3>
            <div class="control">
                <label class="radio-group-label">Smoothing Mode</label>
                <div class="radio-group">
                    <label><input type="radio" name="smoothingMode" value="post" checked> Post</label>
                    <label><input type="radio" name="smoothingMode" value="live"> Live</label>
                </div>
            </div>
            <div class="control">
                <label for="smoothingRatio">Smoothing Ratio <span class="value-display" id="smoothingRatio-val">0.5</span></label>
                <input type="range" id="smoothingRatio" min="0" max="1" step="0.05" value="0.5">
            </div>
            <div class="control">
                <label for="minDistance">Min Point Distance <span class="value-display" id="minDistance-val">0.8</span></label>
                <input type="range" id="minDistance" min="0.1" max="5" step="0.1" value="0.8">
            </div>
            <div class="control">
                <label for="smoothingFadePoints">Fade Points <span class="value-display" id="smoothingFadePoints-val">4</span></label>
                <input type="range" id="smoothingFadePoints" min="0" max="10" step="1" value="4">
            </div>
        </div>
        <div class="control-group">
            <h3>Export Settings</h3>
            <div class="control">
                <label class="checkbox-group-label">Trim Output <input type="checkbox" id="trimOutput" checked></label>
            </div>
            <div class="control">
                <label for="outputPenColor">Output Pen Color <input type="checkbox" id="enableOutputPenColor"></label>
                <input type="color" id="outputPenColor" value="#000000" disabled>
            </div>
            <div class="control">
                <label for="outputBackgroundColor">Output Background <input type="checkbox" id="enableOutputBackgroundColor"></label>
                <input type="color" id="outputBackgroundColor" value="#ffffff" disabled>
                <label class="checkbox-group-label" style="font-size: 0.8rem; margin-top: 0.5rem;">Transparent <input type="checkbox" id="transparentBg" disabled></label>
            </div>
            <div class="control">
                <label for="dpi">Image DPI:</label>
                <select id="dpi" name="dpi">
                    <option value="150">150</option>
                    <option value="300" selected>300</option>
                    <option value="600">600</option>
                </select>
            </div>
        </div>
    </aside>

    <section class="main-content">
        <div class="signature-wrapper" id="signature-container">
            <h2>Signature Canvas</h2>
            <div class="canvas-container">
                <canvas class="signature-canvas"></canvas>
            </div>
            <div class="actions-group">
                <button class="btn btn-clear">Clear</button>
                <button class="btn btn-undo">Undo</button>
                <button class="btn btn-info" id="saveDataBtn">Save Data</button>
                <button class="btn btn-secondary" id="loadDataBtn">Load Data</button>
                <button class="btn btn-save">Save & Preview</button>
            </div>
            <div class="output-format-selector">
                <label class="radio-group-label">Output Format</label>
                <div class="radio-group">
                    <label><input type="radio" name="format" value="svg" checked> SVG</label>
                    <label><input type="radio" name="format" value="png"> PNG</label>
                    <label><input type="radio" name="format" value="jpg"> JPG</label>
                </div>
            </div>
            <div class="signature-output">
                <label class="signature-label">Output Code (Click to Copy):</label>
                <textarea class="signature-textarea" readonly></textarea>
                <label class="signature-label" style="margin-top: 1rem;">Preview:</label>
                <div class="signature-preview">
                    <button class="btn-download" title="Download Signature">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM17 13l-5 5-5-5h3V9h4v4h3z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </section>
</main>

<footer>
    <p>&copy; Copyright Cyberzilla 2025. All rights reserved.</p>
</footer>

<script src="czSignature.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const canvas = document.querySelector('.signature-canvas');
        const controlsPanel = document.querySelector('.controls-panel');
        const signatureOutput = document.querySelector('.signature-output');
        const signaturePreview = document.querySelector('.signature-preview');
        const outputTextarea = document.querySelector('.signature-textarea');
        const formatSelector = document.querySelector('.output-format-selector');
        const clearBtn = document.querySelector('.btn-clear');
        const undoBtn = document.querySelector('.btn-undo');
        const saveBtn = document.querySelector('.btn-save');
        const downloadBtn = document.querySelector('.btn-download');
        const saveDataBtn = document.getElementById('saveDataBtn');
        const loadDataBtn = document.getElementById('loadDataBtn');
        const enableOutputPenColor = document.getElementById('enableOutputPenColor');
        const outputPenColorInput = document.getElementById('outputPenColor');
        const enableOutputBgColor = document.getElementById('enableOutputBackgroundColor');
        const outputBgColorInput = document.getElementById('outputBackgroundColor');
        const transparentBgCheckbox = document.getElementById('transparentBg');

        let signaturePad;
        let savedSignatureData = null;

        const initialOptions = {
            penColor: '#000000',
            backgroundColor: '#ffffff',
            minWidth: 1.0,
            maxWidth: 4.0,
            pressureSupport: false,
            smoothingMode: 'post',
            smoothingRatio: 0.5,
            minDistance: 0.8,
            smoothingFadePoints: 4,
        };

        const gatherDisplayOptions = () => ({
            penColor: document.getElementById('penColor').value,
            backgroundColor: document.getElementById('backgroundColor').value,
            minWidth: parseFloat(document.getElementById('minWidth').value),
            maxWidth: parseFloat(document.getElementById('maxWidth').value),
            pressureSupport: document.getElementById('pressureSupport').checked,
            smoothingMode: document.querySelector('input[name="smoothingMode"]:checked').value,
            smoothingRatio: parseFloat(document.getElementById('smoothingRatio').value),
            minDistance: parseFloat(document.getElementById('minDistance').value),
            smoothingFadePoints: parseInt(document.getElementById('smoothingFadePoints').value, 10),
        });

        const debounce = (func, delay) => {
            let timeout;
            return (...args) => {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), delay);
            };
        };

        const showNotification = (message, type = 'success') => {
            const notification = document.createElement('div');
            notification.className = `signature-notification signature-notification-${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => { notification.classList.add('show'); }, 10);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        };

        const dataToBlob = (data, mimeType) => {
            if (mimeType === 'image/svg+xml') { return new Blob([data], {type: mimeType}); }
            const parts = data.split(',');
            const byteString = atob(parts[1]);
            const ab = new ArrayBuffer(byteString.length);
            const ia = new Uint8Array(ab);
            for (let i = 0; i < byteString.length; i++) { ia[i] = byteString.charCodeAt(i); }
            return new Blob([ab], { type: mimeType });
        };

        signaturePad = new czSignature(canvas, initialOptions);

        signaturePad.on('clear', () => {
            signatureOutput.style.display = 'none';
        });
        signaturePad.on('drawStart', () => {
            signatureOutput.style.display = 'none';
        });

        controlsPanel.addEventListener('input', debounce((e) => {
            const target = e.target;
            if (target.type === 'range') {
                const display = document.getElementById(`${target.id}-val`);
                if (display) display.textContent = target.value;
            }

            // Hide outdated preview on any option change
            signatureOutput.style.display = 'none'; // BARU

            if (!target.id.startsWith('output') && !target.id.startsWith('enable') && !target.id.startsWith('transparent') && target.name !== 'dpi') {
                signaturePad.updateOptions(gatherDisplayOptions());
                showNotification('Settings updated!', 'success');
            }
        }, 250));

        formatSelector.addEventListener('change', () => {
            signatureOutput.style.display = 'none';
        });

        enableOutputPenColor.addEventListener('change', () => outputPenColorInput.disabled = !enableOutputPenColor.checked);
        enableOutputBgColor.addEventListener('change', () => {
            const isDisabled = !enableOutputBgColor.checked;
            transparentBgCheckbox.disabled = isDisabled;
            outputBgColorInput.disabled = isDisabled || transparentBgCheckbox.checked;
        });
        transparentBgCheckbox.addEventListener('change', () => {
            if (enableOutputBgColor.checked) {
                outputBgColorInput.disabled = transparentBgCheckbox.checked;
            }
        });

        clearBtn.addEventListener('click', () => signaturePad.clear());
        undoBtn.addEventListener('click', () => signaturePad.undo());

        saveBtn.addEventListener('click', () => {
            if (signaturePad.isEmpty()) {
                showNotification('Please draw a signature first.', 'error');
                return;
            }
            const originalOptions = { ...signaturePad.options };
            const exportOptions = {
                trimOutput: document.getElementById('trimOutput').checked,
                dpi: parseInt(document.getElementById('dpi').value, 10),
                outputPenColor: enableOutputPenColor.checked ? outputPenColorInput.value : null,
                outputBackgroundColor: enableOutputBgColor.checked
                    ? (transparentBgCheckbox.checked ? 'transparent' : outputBgColorInput.value)
                    : null,
            };
            signaturePad.updateOptions(exportOptions);
            const format = document.querySelector('input[name="format"]:checked').value;
            let data, previewContent, mimeType;
            if (format === 'svg') {
                mimeType = 'image/svg+xml';
                data = signaturePad.toSVG();
                previewContent = data;
            } else {
                mimeType = format === 'jpg' ? 'image/jpeg' : 'image/png';
                data = signaturePad.toDataURL(mimeType);
                previewContent = `<img src="${data}" alt="Signature Preview">`;
            }
            signaturePad.updateOptions(originalOptions);
            outputTextarea.value = data;
            signaturePreview.innerHTML = previewContent;
            signaturePreview.appendChild(downloadBtn);
            signatureOutput.style.display = 'block';
            downloadBtn.style.display = 'block';
            showNotification(`Preview generated as ${format.toUpperCase()}.`, 'success');
        });

        saveDataBtn.addEventListener('click', () => {
            if (signaturePad.isEmpty()) {
                showNotification('Canvas is empty, nothing to save.', 'error');
                return;
            }
            savedSignatureData = signaturePad.toData();
            showNotification('Signature data saved to memory.', 'success');
            console.log('Saved Signature Data:', savedSignatureData);
        });

        loadDataBtn.addEventListener('click', () => {
            if (!savedSignatureData) {
                showNotification('No signature data in memory to load.', 'error');
                return;
            }
            signaturePad.fromData(savedSignatureData);
            showNotification('Signature data loaded from memory.', 'success');
        });

        downloadBtn.addEventListener('click', () => {
            const format = document.querySelector('input[name="format"]:checked').value;
            const data = outputTextarea.value;
            if (!data) return;
            const mimeType = format === 'svg' ? 'image/svg+xml' : (format === 'jpg' ? 'image/jpeg' : 'image/png');
            const filename = `signature.${format}`;
            const blob = dataToBlob(data, mimeType);
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        outputTextarea.addEventListener('click', () => {
            if (!outputTextarea.value) return;
            navigator.clipboard.writeText(outputTextarea.value)
                .then(() => showNotification('Code copied to clipboard.', 'success'))
                .catch(() => showNotification('Failed to copy code.', 'error'));
        });
    });
</script>
</body>
</html>